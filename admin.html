<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† | THE GIANT</title>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {--bg:#0b0f19;--card:#111827;--accent:#00b2ff;--ok:#00b258;--danger:#e63946;--muted:#ccc;}
*{box-sizing:border-box}
body{background:var(--bg);color:#fff;font-family:"Cairo",sans-serif;margin:0;padding:2rem;-webkit-font-smoothing:antialiased;}
h1{text-align:center;color:var(--accent);margin:0}
.dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-top:1.4rem;}
.card{background:var(--card);border-radius:15px;padding:1.6rem;text-align:center;transition:0.25s;cursor:default;box-shadow:0 6px 20px rgba(2,6,23,0.6);}
.card:hover{transform:translateY(-4px);background:#131c2a;}
.card h2{color:var(--accent);margin:0 0 .4rem}
.card p{color:var(--muted);margin:0}
#notifBtn{position:fixed;top:20px;left:20px;background:var(--accent);border:none;border-radius:50%;width:50px;height:50px;color:#fff;font-size:22px;cursor:pointer;z-index:60;}
#notifBtn span{position:absolute;top:-5px;right:-5px;background:#e63946;border-radius:50%;font-size:12px;padding:3px 6px;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:70;}
.modal .box{background:var(--card);border-radius:12px;padding:1.5rem;width:90%;max-width:900px;max-height:90vh;overflow:auto;}
.tabs{display:flex;justify-content:center;margin-bottom:1rem;flex-wrap:wrap;}
.tabs button{background:#1e2636;color:#fff;border:none;padding:10px 18px;cursor:pointer;border-radius:8px;margin:4px;transition:0.25s;font-weight:bold;}
.tabs button.active{background:var(--accent);color:#000;}
.tab-content{display:none;}
.tab-content.active{display:block;}
.req{background:#0e1721;border-radius:10px;padding:10px;margin:10px 0;}
.req p{margin:6px 0;color:var(--muted);font-size:0.98rem;}
.clear-btn{background:var(--danger);color:#fff;border:none;padding:8px 12px;border-radius:8px;font-weight:bold;cursor:pointer;margin-top:10px;}
.clear-btn:hover{background:#c11e2e;}
.btn-logout{display:block;margin:2rem auto;padding:12px 26px;font-family:"Cairo",sans-serif;font-size:1.05rem;font-weight:600;color:#fff;background:linear-gradient(45deg,#e63946,#b91c1c);border:none;border-radius:12px;cursor:pointer;box-shadow:0 4px 15px rgba(230,57,70,0.4);transition:all 0.25s ease-in-out;}
.btn-logout:hover{transform:scale(1.07);background:linear-gradient(45deg,#ef4444,#991b1b);box-shadow:0 6px 20px rgba(239,68,68,0.5);}
@media(max-width:600px){body{padding:1rem}.btn-logout{width:100%}}
#gradesList{max-height:400px;overflow-y:auto;padding-right:6px;}
#gradesList::-webkit-scrollbar{width:6px;}
#gradesList::-webkit-scrollbar-thumb{background:var(--accent);border-radius:4px;}
.search-box input{width:100%;padding:10px;border-radius:8px;border:none;margin-bottom:10px;font-family:"Cairo",sans-serif;}
</style>
</head>
<body>
<button id="notifBtn">ğŸ””<span id="notifCount" style="display:none;">0</span></button>
<h1>ğŸ‘¨â€ğŸ’» Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</h1>
<div class="dashboard">
  <div class="card" onclick="window.location.href='teachers.html'"><h2>ğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†</h2><p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†</p></div>
  <div class="card" onclick="window.location.href='courses.html'"><h2>ğŸ“š Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</h2><p>Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ Ø­Ø°Ù ÙƒÙˆØ±Ø³Ø§Øª</p></div>
  <div class="card" onclick="window.location.href='content.html'"><h2>ğŸ“– Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h2><p>Ø±ÙØ¹ Ø§Ù„Ø¯Ø±ÙˆØ³ ÙˆØ§Ù„Ù…ÙˆØ§Ø¯</p></div>
  <div class="card" id="studentsCard"><h2>ğŸ‘¨â€ğŸ“ Ø§Ù„Ø·Ù„Ø§Ø¨</h2><p>Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</p></div>
</div>
<button class="btn-logout" id="logoutBtn">ğŸ”’ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
<div id="notifModal" class="modal">
  <div class="box">
    <div class="tabs">
      <button id="tab-requests" class="active">ğŸ“© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
      <button id="tab-reviews">â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</button>
      <button id="tab-grades">ğŸ§® Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</button>
      <button id="tab-homeworks">ğŸ“˜ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</button>
      <button id="tab-students">ğŸ‘¨â€ğŸ“ Ø§Ù„Ø·Ù„Ø§Ø¨</button>
    </div>
    <div id="requestsTab" class="tab-content active"><div id="requestsList"></div><button class="clear-btn" id="clearNotif">ğŸ—‘ï¸ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button></div>
    <div id="reviewsTab" class="tab-content"><div id="reviewsList"></div><button class="clear-btn" id="clearReviews">ğŸ—‘ï¸ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</button></div>
    <div id="gradesTab" class="tab-content"><div id="gradesList"></div></div>
    <div id="homeworksTab" class="tab-content"><div id="homeworksList"></div></div>
    <div id="studentsTab" class="tab-content">
      <div class="search-box"><input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±..."></div>
      <div id="studentsList"></div>
    </div>
    <button onclick="closeModal()" style="background:#555;padding:8px 14px;border:none;border-radius:8px;color:#fff;margin-top:8px;">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
const firebaseConfig={apiKey:"AIzaSyDW80ZbwOB7QHHW76kSL9cqlzMoyPFZ7nI",authDomain:"ylearn-fe1fa.firebaseapp.com",databaseURL:"https://ylearn-fe1fa-default-rtdb.firebaseio.com",projectId:"ylearn-fe1fa",storageBucket:"ylearn-fe1fa.appspot.com",messagingSenderId:"1092852055944",appId:"1:1092852055944:web:85c3df7cf4c0cbcdca043d"};
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
document.getElementById("logoutBtn").addEventListener("click",async()=>{
  try{await signOut(auth);alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­");window.location.href="login.html";}
  catch(e){alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬: "+e.message);}
});
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, onValue, set, get, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
const firebaseConfig={apiKey:"AIzaSyDW80ZbwOB7QHHW76kSL9cqlzMoyPFZ7nI",authDomain:"ylearn-fe1fa.firebaseapp.com",databaseURL:"https://ylearn-fe1fa-default-rtdb.firebaseio.com",projectId:"ylearn-fe1fa",storageBucket:"ylearn-fe1fa.appspot.com",messagingSenderId:"1092852055944",appId:"1:1092852055944:web:85c3df7cf4c0cbcdca043d"};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const notifBtn=document.getElementById('notifBtn');
const notifModal=document.getElementById('notifModal');
const notifCount=document.getElementById('notifCount');
const requestsList=document.getElementById('requestsList');
const reviewsList=document.getElementById('reviewsList');
const gradesList=document.getElementById('gradesList');
const homeworksList=document.getElementById('homeworksList');
const studentsList=document.getElementById('studentsList');

const clearBtn=document.getElementById('clearNotif');
const clearReviews=document.getElementById('clearReviews');

const tabReq=document.getElementById('tab-requests');
const tabRev=document.getElementById('tab-reviews');
const tabGrades=document.getElementById('tab-grades');
const tabHomeworks=document.getElementById('tab-homeworks');
const tabStudents=document.getElementById('tab-students');

const reqTab=document.getElementById('requestsTab');
const revTab=document.getElementById('reviewsTab');
const grdTab=document.getElementById('gradesTab');
const hwTab=document.getElementById('homeworksTab');
const stuTab=document.getElementById('studentsTab');

function switchTab(a){[tabReq,tabRev,tabGrades,tabHomeworks,tabStudents].forEach(b=>b.classList.remove('active'));[reqTab,revTab,grdTab,hwTab,stuTab].forEach(c=>c.classList.remove('active'));a.btn.classList.add('active');a.tab.classList.add('active');}
tabReq.onclick=()=>switchTab({btn:tabReq,tab:reqTab});
tabRev.onclick=()=>switchTab({btn:tabRev,tab:revTab});
tabGrades.onclick=()=>switchTab({btn:tabGrades,tab:grdTab});
tabHomeworks.onclick=()=>switchTab({btn:tabHomeworks,tab:hwTab});
tabStudents.onclick=()=>switchTab({btn:tabStudents,tab:stuTab});

notifBtn.onclick=()=>notifModal.style.display='flex';
window.closeModal=()=>notifModal.style.display='none';

clearBtn.onclick=async()=>{if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŸ")){await remove(ref(db,'unlockRequests'));requestsList.innerHTML='<p>ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª âœ…</p>';notifCount.style.display='none';}};

onValue(ref(db,'unlockRequests'),async s=>{requestsList.innerHTML='';if(!s.exists()){requestsList.innerHTML='<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';notifCount.style.display='none';return;}
const all=s.val();let count=0;for(const [id,r] of Object.entries(all)){count++;
const user=await get(ref(db,`users/${r.studentId}`));const st=user.exists()?user.val():{};
const codeP=`activationCodes/${r.studentId}_${r.courseId}`;const codeS=await get(ref(db,codeP));
let code;if(!codeS.exists()){const newC=Math.random().toString(36).substring(2,10).toUpperCase();
code={code:newC,studentName:st.fullName||'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',studentNumber:st.studentNumber||'-',courseName:r.courseName,date:new Date(r.timestamp).toLocaleString('ar-EG')};
await set(ref(db,codeP),code);}else code=codeS.val();
const d=document.createElement('div');d.className='req';
d.innerHTML=`<p>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${code.studentName}</p><p>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨: ${code.studentNumber}</p><p>ğŸ“˜ Ø§Ù„ÙƒÙˆØ±Ø³: ${code.courseName}</p><p>ğŸ“… ${code.date}</p><p>ğŸ”‘ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„: <span style="color:#00b2ff">${code.code}</span></p>`;
requestsList.appendChild(d);}notifCount.style.display=count>0?'inline':'none';notifCount.textContent=count;});

clearReviews.onclick=async()=>{if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§ØªØŸ")){await remove(ref(db,'notifications/feedbacks'));reviewsList.innerHTML='<p>ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª âœ…</p>';}}
onValue(ref(db,'notifications/feedbacks'),s=>{reviewsList.innerHTML='';if(!s.exists()){reviewsList.innerHTML='<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';return;}for(const [id,r] of Object.entries(s.val())){const d=document.createElement('div');d.className='req';d.innerHTML=`<p>â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${r.rating||'-'}</p><p>ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚: ${r.message||'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</p>`;reviewsList.appendChild(d);}});

onValue(ref(db,'grades'),s=>{gradesList.innerHTML='';if(!s.exists()){gradesList.innerHTML='<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±Ø¬Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';return;}for(const [sid,exams] of Object.entries(s.val())){for(const [eid,g] of Object.entries(exams)){const d=document.createElement('div');d.className='req';d.innerHTML=`<p>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${g.studentName||'-'}</p><p>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨: ${g.studentPhone||'-'}</p><p>ğŸ“± Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±: ${g.parentPhone||'-'}</p><p>ğŸ§¾ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†: ${g.examTitle||'-'}</p><p>ğŸ“Š Ø§Ù„Ø¯Ø±Ø¬Ø©: ${g.score||0} / ${g.total||0}</p>`;gradesList.appendChild(d);}}});

onValue(ref(db,'homeworkResult'),async snap=>{
  homeworksList.innerHTML='';
  if(!snap.exists()){
    homeworksList.innerHTML='<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';
    return;
  }

  for(const [studentId,subs] of Object.entries(snap.val())){
    const studentSnap=await get(ref(db,`users/${studentId}`));
    const student=studentSnap.exists()?studentSnap.val():{};

    for(const [hwId,hw] of Object.entries(subs)){
      const d=document.createElement('div');
      d.className='req';
      d.innerHTML=`
        <p>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${hw.name || student.fullName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
        <p>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨: ${hw.phone || student.studentNumber || '-'}</p>
        <p>ğŸ“± Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±: ${hw.parentPhone || student.parentNumber || '-'}</p>
        <p>ğŸ“˜ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ§Ø¬Ø¨: ${hw.title || '-'}</p>
        <p>âœ… ØµØ­ÙŠØ­Ø©: ${hw.correct || 0}</p>
        <p>âŒ Ø®Ø§Ø·Ø¦Ø©: ${hw.wrong || 0}</p>
        <p>ğŸ“Š Ø§Ù„Ù†Ø³Ø¨Ø©: ${hw.percentage || 0}%</p>
        <p>ğŸ§® Ø§Ù„Ø¯Ø±Ø¬Ø©: ${hw.score || 0} / ${hw.total || 0}</p>
        <p>â³ Ø§Ù„Ø²Ù…Ù† Ø§Ù„Ù…Ø³ØªØºØ±Ù‚: ${hw.timeTakenMin || 0} Ø¯Ù‚ÙŠÙ‚Ø©</p>
        <p>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ù„: ${hw.finishedAt ? new Date(hw.finishedAt).toLocaleString('ar-EG') : '-'}</p>
      `;
      homeworksList.appendChild(d);
    }
  }
});

onValue(ref(db,'users'),async s=>{studentsList.innerHTML='';if(!s.exists()){studentsList.innerHTML='<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';return;}
const coursesSnap=await get(ref(db,'courses'));const allCourses=coursesSnap.exists()?coursesSnap.val():{};
window.allStudents=[];for(const [sid,st] of Object.entries(s.val())){const userSnap=await get(ref(db,`users/${sid}`));const user=userSnap.exists()?userSnap.val():{};
const div=document.createElement('div');div.className='req';let courseNames=[];
if(st.purchased){for(const cid of Object.keys(st.purchased)){for(const [k,c] of Object.entries(allCourses)){if(k===cid||c.id===cid)courseNames.push(c.name||'ÙƒÙˆØ±Ø³ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ');}}}
div.innerHTML=`<p>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${user.fullName||'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p><p>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨: ${user.studentNumber||'-'}</p><p>ğŸ“± Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±: ${user.parentNumber||'-'}</p><p>ğŸ“ Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${user.grade||'-'}</p><p>ğŸ“˜ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©:</p><ul style='color:#00b2ff;'>${courseNames.length?courseNames.map(n=>`<li>${n}</li>`).join(''):'<li>Ù„Ø§ ÙŠÙˆØ¬Ø¯</li>'}</ul>`;
studentsList.appendChild(div);
window.allStudents.push({el:div,name:(user.fullName||'').toLowerCase(),num:(user.studentNumber||''),parent:(user.parentNumber||'')});
}

const searchInput=document.getElementById('searchInput');
searchInput.addEventListener('input',()=>{const val=searchInput.value.toLowerCase();for(const s of window.allStudents){const match=s.name.includes(val)||s.num.includes(val)||s.parent.includes(val);s.el.style.display=match?'':'none';}});
});

document.getElementById("studentsCard").addEventListener("click",()=>{notifModal.style.display='flex';switchTab({btn:tabStudents,tab:stuTab});});
</script>
</body>
</html>