<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ğŸ“˜ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙƒÙˆØ±Ø³ - Ù…Ù†ØµØ© THE GIANT</title>
<style>
  body{margin:0;font-family:"Cairo",sans-serif;background:#0b0f19;color:#fff;min-height:100vh}
  header{background:#111827;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 0 10px rgba(0,0,0,0.3)}
  header h1{color:#00b2ff;margin:0;font-size:1.3rem}
  button{border:none;border-radius:8px;cursor:pointer;transition:0.3s}
  button.back{background:#00b2ff;color:#fff;padding:0.6rem 1.2rem}
  button:hover{opacity:0.9}
  .content{padding:1rem;max-width:900px;margin:auto}
  .card{background:#1e2636;padding:1rem;border-radius:10px;margin:1rem 0;box-shadow:0 0 10px rgba(0,0,0,0.3)}
  .card h2{color:#00b2ff;margin-bottom:0.3rem}
  .card h4{margin:0.4rem 0;color:#bbb}
  .card iframe{width:100%;height:350px;border:none;border-radius:8px;margin-top:0.8rem}
  .exam-btn{background:#00b2ff;color:#fff;padding:0.6rem 1rem;border-radius:8px;margin-top:0.8rem;display:inline-block;text-decoration:none}
  .exam-btn.disabled{background:#555;cursor:not-allowed;opacity:0.6}
</style>
</head>
<body>
  <header>
    <h1>ğŸ“˜ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙƒÙˆØ±Ø³</h1>
    <button class="back">Ø±Ø¬ÙˆØ¹</button>
  </header>

  <div class="content">
    <div id="contentArea">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰...</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDW80ZbwOB7QHHW76kSL9cqlzMoyPFZ7nI",
      authDomain: "ylearn-fe1fa.firebaseapp.com",
      databaseURL: "https://ylearn-fe1fa-default-rtdb.firebaseio.com",
      projectId: "ylearn-fe1fa",
      storageBucket: "ylearn-fe1fa.firebasestorage.app",
      messagingSenderId: "1092852055944",
      appId: "1:1092852055944:web:85c3df7cf4c0cbcdca043d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const contentArea = document.getElementById("contentArea");

    const urlParams = new URLSearchParams(window.location.search);
    const selectedCourseId = urlParams.get("courseId") || localStorage.getItem("selectedCourseId");
    if (selectedCourseId) localStorage.setItem("selectedCourseId", selectedCourseId);

    function fixYouTubeLink(url) {
      if (!url) return "";
      url = url.replace("m.youtube.com", "www.youtube.com");
      let videoId = "";
      if (url.includes("watch?v=")) {
        videoId = url.split("watch?v=")[1].split("&")[0];
      } else if (url.includes("youtu.be/")) {
        videoId = url.split("youtu.be/")[1].split("?")[0];
      } else if (url.includes("/embed/")) {
        return url;
      }
      return `https://www.youtube.com/embed/${videoId}`;
    }

    async function loadCourseContent() {
      if (!selectedCourseId) {
        contentArea.innerHTML = "<p>âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ ÙƒÙˆØ±Ø³.</p>";
        return;
      }

      const snap = await get(ref(db, `courses/${selectedCourseId}/content`));
      if (!snap.exists()) {
        contentArea.innerHTML = "<p>âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø¨Ø¹Ø¯.</p>";
        return;
      }

      contentArea.innerHTML = "";
      const allContent = Object.entries(snap.val());
      const lessons = allContent.filter(([_, item]) => item.type === "Ø´Ø±Ø­");
      const exams = allContent.filter(([_, item]) => item.type === "Ø§Ù…ØªØ­Ø§Ù†");

      if (lessons.length) {
        const h = document.createElement("h2");
        h.textContent = "ğŸ“š Ù‚Ø³Ù… Ø§Ù„Ø´Ø±ÙˆØ­Ø§Øª";
        contentArea.appendChild(h);
      }

      lessons.forEach(([id, item]) => {
        const div = document.createElement("div");
        div.className = "card";
        const videoUrl = fixYouTubeLink(item.video);
        div.innerHTML = `
          <h2>ğŸ“– ${item.title}</h2>
          ${item.note ? `<h4>${item.note}</h4>` : ""}
          ${videoUrl ? `<iframe src="${videoUrl}" allowfullscreen></iframe>` : ""}
        `;
        contentArea.appendChild(div);
      });

      if (exams.length) {
        const h = document.createElement("h2");
        h.textContent = "ğŸ§© Ù‚Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª";
        contentArea.appendChild(h);
      }

      exams.forEach(([id, item]) => {
        const div = document.createElement("div");
        div.className = "card";

        // ğŸ”’ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù…Ø­Ù„ÙˆÙ„ Ù‚Ø¨Ù„ ÙƒØ¯Ù‡
        const doneKey = `exam_done_${id}`;
        const isDone = localStorage.getItem(doneKey) === "true";

        div.innerHTML = `
          <h2>ğŸ“ ${item.title}</h2>
          ${item.desc ? `<h4>${item.desc}</h4>` : ""}
          ${item.time ? `<p>â±ï¸ Ø§Ù„Ù…Ø¯Ø©: ${item.time} Ø¯Ù‚ÙŠÙ‚Ø©</p>` : ""}
          ${
            isDone
              ? `<button class="exam-btn disabled" disabled>âœ… ØªÙ… Ø­Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>`
              : `<a href="exam.html?examId=${id}&courseId=${selectedCourseId}" class="exam-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</a>`
          }
        `;
        contentArea.appendChild(div);
      });
    }

    loadCourseContent();

    document.querySelector(".back").addEventListener("click", () => {
      window.history.back();
    });
  </script>
</body>
</html>